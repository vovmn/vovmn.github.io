import{_ as oe,f as m,e as h,l as k,j as ie,m as re,c as o,d as R,a as s,g as T,h as f,p as ue,v as ce,q as de,s as ve,t as g,u as b,F as M,i as F,b as P,x as pe,y as he,o as n,z as j}from"./index-DD3evdr7.js";import{H as ge,F as me}from"./Footer-CvjhGzBU.js";import{u as fe,M as be,C as ye}from"./useProducts-CU1i1zu3.js";const _e={class:"catalog-page"},ke={class:"catalog-main"},Ce={class:"container"},we={class:"search-container"},xe={class:"search-box"},Me=["onKeydown"],Pe={key:0,class:"search-info"},Se={key:0},Le={key:1},ze={style:{display:"flex",gap:"0.5rem","align-items":"center"}},Fe=["disabled"],Ve={key:1,class:"loading"},Ie={key:2,class:"error"},Be={key:3},Ee={class:"category-filters"},Ae=["onClick"],qe={key:0,class:"no-results"},De={class:"no-results-text"},Ke={class:"pagination-info"},Ne={class:"pagination-stats"},Ue={class:"products-grid"},$e={key:0,class:"pagination"},Re=["disabled"],Te={class:"pagination-numbers"},je=["onClick"],He={key:0,class:"pagination-ellipsis"},Qe=["disabled"],Ge={key:2,class:"no-products"},y=21,Je={__name:"Catalog",setup(Oe){const C=pe(),V=he(),{loading:H,error:I,getFilteredProducts:Q,getAllCategories:G,reloadProducts:B}=fe(),E=G(),A=()=>{const e=C.query;return{filter:e.filter&&E.some(t=>t.id===e.filter)?e.filter:"all",page:e.page&&parseInt(e.page)>0?parseInt(e.page):1,search:e.search?String(e.search):""}},w=A(),c=m(w.filter),a=m(w.page),u=m(w.search),i=m(w.search),x=m(!1),S=m(null),L=m(!1),J=h(()=>(a.value-1)*y);function O(){const e={};return c.value!=="all"&&(e.filter=c.value),a.value!==1&&(e.page=String(a.value)),i.value&&(e.search=i.value),e}function _(){V.replace({query:O(),hash:C.hash})}k(c,()=>_()),k(a,()=>_()),k(c,()=>{a.value=1});const q=()=>{const e=u.value.trim();i.value=e,a.value=1,_()},W=()=>{u.value=""},D=()=>{u.value="",i.value="",a.value=1,_()},X=(e,t)=>{if(!t||t.trim()==="")return e;const l=t.toLowerCase().trim();return e.filter(r=>{if(!r||typeof r!="object")return!1;const d=String(r.name||"").toLowerCase(),ae=String(r.description||"").toLowerCase(),ne=String(r.category||"").toLowerCase();return d.includes(l)||ae.includes(l)||ne.includes(l)})},v=h(()=>{let e=Q(c.value);return i.value&&(e=X(e,i.value)),e}),Y=h(()=>{const e=(a.value-1)*y;return v.value.slice(e,e+y)}),p=h(()=>Math.ceil(v.value.length/y)),Z=h(()=>(a.value-1)*y+1),ee=h(()=>{const e=a.value*y;return e>v.value.length?v.value.length:e});k(p,e=>{a.value>e&&e>0&&(a.value=e)});const K=h(()=>{const t=[];if(p.value<=5){for(let d=1;d<=p.value;d++)t.push(d);return t}let l=Math.max(1,a.value-2),r=Math.min(p.value,l+5-1);r-l+1<5&&(l=Math.max(1,r-5+1));for(let d=l;d<=r;d++)t.push(d);return t}),te=h(()=>p.value>K.value.length),se=e=>{c.value=e,u.value="",i.value="",a.value=1,_()},z=e=>{L.value||e<1||e>p.value||(L.value=!0,a.value=e,requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>L.value=!1,400)}))},N=e=>{S.value=e,x.value=!0,document.body.style.overflow="hidden"},U=()=>{x.value=!1,S.value=null,document.body.style.overflow="auto"},$=e=>{e.key==="Escape"&&x.value&&U()},le=()=>{c.value="all",a.value=1,u.value="",i.value="",V.replace({name:C.name})};return k(()=>C.query,()=>{const e=A();c.value=e.filter,a.value=e.page,u.value=e.search,i.value=e.search}),ie(()=>{document.addEventListener("keydown",$)}),re(()=>{document.removeEventListener("keydown",$)}),(e,t)=>(n(),o("div",_e,[R(ge),s("main",ke,[s("div",Ce,[t[14]||(t[14]=s("h1",{class:"page-title"},"Каталог продукции",-1)),c.value!=="all"||i.value||a.value!==1?(n(),o("button",{key:0,onClick:le,class:"reset-filters-btn"}," Сбросить все фильтры ")):f("",!0),s("div",we,[s("div",xe,[t[5]||(t[5]=s("svg",{class:"search-icon",viewBox:"0 0 24 24",width:"20",height:"20"},[s("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})],-1)),ue(s("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),type:"text",class:"search-input",placeholder:"Поиск товаров...",onKeydown:de(ve(q,["prevent"]),["enter"])},null,40,Me),[[ce,u.value]]),u.value?(n(),o("button",{key:0,onClick:W,class:"clear-search-btn",type:"button","aria-label":"Очистить"},[...t[4]||(t[4]=[s("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[s("path",{fill:"currentColor",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])):f("",!0)]),u.value||i.value?(n(),o("div",Pe,[i.value?(n(),o("span",Se,"Найдено товаров: "+g(v.value.length),1)):(n(),o("span",Le,"Введите запрос и нажмите Enter")),s("div",ze,[s("button",{class:"clear-all-btn",type:"button",onClick:q,disabled:!u.value.trim(),title:"Применить поиск"}," Найти ",8,Fe),i.value?(n(),o("button",{key:0,class:"clear-all-btn",type:"button",onClick:D,title:"Очистить примененный поиск"}," Очистить поиск ")):f("",!0)])])):f("",!0)]),b(H)?(n(),o("div",Ve,[...t[6]||(t[6]=[s("div",{class:"spinner"},null,-1),s("p",null,"Загрузка каталога...",-1)])])):b(I)?(n(),o("div",Ie,[s("p",null,"Ошибка загрузки каталога: "+g(b(I)),1),s("button",{onClick:t[1]||(t[1]=(...l)=>b(B)&&b(B)(...l)),class:"retry-btn"},"Попробовать снова")])):(n(),o("div",Be,[s("div",Ee,[(n(!0),o(M,null,F(b(E),l=>(n(),o("button",{key:l.id,class:j(["filter-btn",{active:c.value===l.id}]),onClick:r=>se(l.id)},g(l.name),11,Ae))),128))]),i.value&&v.value.length===0?(n(),o("div",qe,[t[9]||(t[9]=s("svg",{class:"no-results-icon",viewBox:"0 0 24 24",width:"48",height:"48"},[s("path",{fill:"#6b7280",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})],-1)),t[10]||(t[10]=s("p",{class:"no-results-title"},"Товары не найдены",-1)),s("p",De,[P(' По запросу "'+g(i.value)+'" ничего не найдено. ',1),t[7]||(t[7]=s("br",null,null,-1)),t[8]||(t[8]=P("Попробуйте изменить запрос или сбросить фильтры. ",-1))]),s("button",{onClick:D,class:"back-to-catalog-btn"}," Вернуться к каталогу ")])):v.value.length>0?(n(),o(M,{key:1},[s("div",Ke,[s("div",Ne," Показано "+g(Z.value)+"-"+g(ee.value)+" из "+g(v.value.length)+" товаров ",1)]),s("div",Ue,[(n(!0),o(M,null,F(Y.value,(l,r)=>(n(),T(ye,{key:l.id,product:l,index:J.value+r,"eager-count":8,"high-priority-count":2,onDetailsClick:N,onCardClick:N},null,8,["product","index"]))),128))]),p.value>1?(n(),o("div",$e,[s("button",{disabled:a.value===1,onClick:t[2]||(t[2]=l=>z(a.value-1)),class:"pagination-btn pagination-prev"},[...t[11]||(t[11]=[s("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[s("path",{fill:"currentColor",d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1),P(" Назад ",-1)])],8,Re),s("div",Te,[(n(!0),o(M,null,F(K.value,l=>(n(),o("button",{key:l,onClick:r=>z(l),class:j(["pagination-number",{active:a.value===l}])},g(l),11,je))),128)),te.value?(n(),o("span",He,"...")):f("",!0)]),s("button",{disabled:a.value===p.value,onClick:t[3]||(t[3]=l=>z(a.value+1)),class:"pagination-btn pagination-next"},[...t[12]||(t[12]=[P(" Вперед ",-1),s("svg",{viewBox:"0 0 24 24",width:"16",height:"16"},[s("path",{fill:"currentColor",d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)])],8,Qe)])):f("",!0)],64)):(n(),o("div",Ge,[...t[13]||(t[13]=[s("p",null,"Товары в этой категории скоро появятся",-1)])]))]))])]),x.value?(n(),T(be,{key:0,product:S.value,onClose:U},null,8,["product"])):f("",!0),R(me)]))}},Ze=oe(Je,[["__scopeId","data-v-dbe76dee"]]);export{Ze as default};
